import{e,v as t,j as a,g as s,x as r,i as o,u as i,t as n,y as l,z as c,A as d,B as u,m as p,r as h,c as w,C as m,o as v}from"./vue-vendor.js";import{c as f,u as b,a as g,_ as x}from"./index.js";import{L as y}from"./lock.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=f("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),j="/cgi-bin/wx-auth.sh";const _={class:"min-h-screen flex items-center justify-center p-4 bg-dark-500"},L={class:"w-full max-w-[340px] relative"},S={class:"card p-6 md:p-8 bg-dark-400/50 backdrop-blur-xl border-white/5 shadow-2xl overflow-hidden"},C={class:"form-container h-[180px] flex flex-col justify-center px-2"},M={key:0,class:"text-center"},O={class:"w-12 h-12 rounded-full bg-danger-500/10 flex items-center justify-center mx-auto mb-3"},I={class:"px-4 py-2 rounded-xl bg-warning-500/10 border border-warning-500/20 text-warning-400 text-xs inline-flex items-center gap-2"},T={type:"submit",class:"btn btn-primary w-full h-12 text-base font-bold shadow-lg shadow-primary-500/20 group"},P=x(e({__name:"Login",setup(e){const f=m(),x=b(),P=g(),U=h("loading"),V=h(!1),$=h(!1),A=h(0),B=h(""),J=h(""),N=w(()=>"loading"===U.value?"loading":$.value?"locked":V.value?"login":"setup");async function W(){if(!B.value||B.value.length<6)P.error("密码长度不能少于6位");else if(B.value===J.value){P.showLoading("正在保存安全设置");try{const e=await async function(e){return(await fetch(`${j}?action=create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})})).json()}(B.value);P.hideLoading(),"success"===e.status?(P.success("密码创建成功"),V.value=!0,B.value=""):P.error(e.message)}catch{P.hideLoading(),P.error("创建密码失败")}}else P.error("两次输入的密码不一致")}async function q(){if(B.value){P.showLoading("正在验证身份");try{const e=await async function(e){const t=await fetch(`${j}?action=verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})}),a=await t.json();return"success"===a.status&&a.token&&localStorage.setItem("wx_auth_token",a.token),a}(B.value);"success"===e.status?(x.setWxAuthenticated(!0),f.push("/")):(P.hideLoading(),"locked"===e.status?($.value=!0,A.value=e.remaining_time||3600,P.error(e.message)):P.error(e.message))}catch{P.hideLoading(),P.error("验证失败，请检查网络")}}else P.error("请输入密码")}return t(async()=>{P.hideLoading();"conflict"===localStorage.getItem("wx_logout_reason")&&(P.error("登录已失效，请重新登录"),localStorage.removeItem("wx_logout_reason"));try{const e=await async function(){return(await fetch(`${j}?action=check`)).json()}();V.value=e.password_set}catch{P.error("无法连接服务器")}finally{U.value="ready"}}),(e,t)=>(v(),a("div",_,[t[9]||(t[9]=s("div",{class:"fixed inset-0 overflow-hidden pointer-events-none"},[s("div",{class:"absolute -top-[10%] -left-[10%] w-[40%] h-[40%] bg-primary-500/5 rounded-full blur-[120px]"}),s("div",{class:"absolute -bottom-[10%] -right-[10%] w-[40%] h-[40%] bg-accent-500/5 rounded-full blur-[120px]"})],-1)),s("div",L,[s("div",S,[t[7]||(t[7]=r('<div class="text-center mb-4 pt-2" data-v-567676b9><div class="wifi-icon inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-500 to-primary-600 shadow-lg shadow-primary-500/20 mb-4 cursor-default" data-v-567676b9><svg class="w-9 h-9" viewBox="0 0 24 24" fill="none" data-v-567676b9><circle cx="12" cy="19" r="2" fill="white" data-v-567676b9></circle><path class="wifi-arc wifi-arc-1" d="M8.5 15.5C9.5 14.5 10.7 14 12 14s2.5.5 3.5 1.5" stroke="white" stroke-width="2" stroke-linecap="round" data-v-567676b9></path><path class="wifi-arc wifi-arc-2" d="M5.5 12.5C7.3 10.7 9.5 10 12 10s4.7.7 6.5 2.5" stroke="white" stroke-width="2" stroke-linecap="round" data-v-567676b9></path><path class="wifi-arc wifi-arc-3" d="M2.5 9.5C5.2 6.8 8.4 6 12 6s6.8.8 9.5 3.5" stroke="white" stroke-width="2" stroke-linecap="round" data-v-567676b9></path></svg></div><h1 class="text-xl font-bold text-white tracking-tight" data-v-567676b9>WiFi Manager</h1><p class="text-slate-500 text-xs mt-1" data-v-567676b9>无线中继管理系统</p></div>',1)),s("div",C,["locked"===N.value?(v(),a("div",M,[s("div",O,[o(i(y),{class:"w-6 h-6 text-danger-400/80"})]),t[3]||(t[3]=s("h3",{class:"text-base font-bold text-danger-400 mb-2"},"账号已锁定",-1)),s("div",I,[o(i(k),{class:"w-3.5 h-3.5"}),s("span",null,"请 "+n(Math.ceil(A.value/60))+" 分钟后重试",1)])])):"setup"===N.value?(v(),a("form",{key:1,class:"space-y-3",onSubmit:l(W,["prevent"])},[c(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>B.value=e),type:"password",class:"input text-center h-12 text-base tracking-[0.2em] bg-white/5 border-white/10 focus:border-primary-500/50 transition-all",placeholder:"设置访问密码",autocomplete:"new-password"},null,512),[[d,B.value]]),c(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>J.value=e),type:"password",class:"input text-center h-12 text-base tracking-[0.2em] bg-white/5 border-white/10 focus:border-primary-500/50 transition-all",placeholder:"再次输入确认",autocomplete:"new-password"},null,512),[[d,J.value]]),t[4]||(t[4]=s("button",{type:"submit",class:"btn btn-primary w-full h-12 text-sm font-bold shadow-lg shadow-primary-500/20"}," 创建密码 ",-1))],32)):"login"===N.value?(v(),a("form",{key:2,class:"space-y-4",onSubmit:l(q,["prevent"])},[t[6]||(t[6]=s("input",{type:"text",name:"username",autocomplete:"username",class:"hidden",value:"admin"},null,-1)),c(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>B.value=e),type:"password",class:"input text-center h-12 text-lg tracking-[0.3em] bg-white/5 border-white/10 focus:border-primary-500/50 transition-all",placeholder:"请输入密码",autocomplete:"current-password"},null,512),[[d,B.value]]),s("button",T,[o(i(y),{class:"w-4 h-4 mr-2 group-hover:rotate-12 transition-transform"}),t[5]||(t[5]=u(" 登录系统 ",-1))])],32)):p("",!0)])]),t[8]||(t[8]=s("footer",{class:"mt-8 text-center"},[s("p",{class:"text-slate-600 text-[10px] uppercase tracking-widest opacity-40"}," Crafted with Precision by Okuni ")],-1))])]))}}),[["__scopeId","data-v-567676b9"]]);export{P as default};
