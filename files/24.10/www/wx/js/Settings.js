import{e,K as a,v as s,j as l,g as t,i as r,u as n,z as u,A as o,B as c,k as i,t as p,J as v,f as d,l as m,m as x,w as h,F as b,r as f,o as g,C as y,H as w}from"./vue-vendor.js";import{c as k,a as _,u as V}from"./index.js";import{u as j,D as C}from"./Dialog.js";import{C as U,c as M,a as S,d as z}from"./system.js";import{S as A,b as D}from"./validation.js";import{S as T}from"./settings2.js";import{P as q}from"./power.js";import{E as L,a as P}from"./eye.js";import{L as H}from"./lock.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=k("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]),O=k("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),B=k("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),E=k("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),F=k("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J={class:"space-y-4"},K={class:"flex items-center gap-3 px-1"},N={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-slate-500/20 to-slate-600/10 flex items-center justify-center"},G={class:"card"},Q={class:"space-y-6"},R={class:"form-group"},W={class:"form-group"},X={class:"form-group"},Y={class:"form-group"},Z={key:0,class:"pt-4 border-t border-dark-300"},$={class:"flex items-center gap-3 mb-4"},ee={class:"w-6 h-6 rounded-md bg-accent-500/20 flex items-center justify-center"},ae={class:"flex-1"},se={class:"space-y-4"},le={class:"form-group"},te={class:"relative"},re=["type"],ne={class:"form-group"},ue={class:"relative"},oe=["type"],ce={class:"pt-4 border-t border-dark-300"},ie={class:"card"},pe={class:"grid grid-cols-2 gap-3"},ve={class:"space-y-4"},de={class:"form-group"},me={class:"form-label"},xe={class:"form-group"},he={class:"form-label"},be={class:"form-group"},fe={class:"form-label"},ge={class:"h-[160px] flex flex-col items-center justify-center text-center"},ye={class:"text-xs text-slate-500 mt-1"},we={class:"text-slate-400"},ke={class:"text-accent-400"},_e={class:"w-full h-[42px]"},Ve=e({__name:"Settings",setup(e){const k=y(),Ve=_(),je=V(),Ce=f(!1),Ue=f(!1),Me=f(!1),Se=f(""),ze=f(""),Ae=f(""),De=f(!1),Te=f("idle"),qe=f({currentVersion:"",latestVersion:"",message:""}),Le=a({wxpusher_enabled:0,wx_app_token:"",wx_my_uid:"",wxpusher_api_url:"https://wxpusher.zjiecode.com/api/send/message",ping_target:"223.5.5.5",auto_switch_max_retries:25,retry_wifi_interval:688,restart_threshold:10,show_wxpusher:0}),Pe=a({...Le});async function He(){try{const e=await async function(e){return j.call("wx-wireless","save_settings",e)}(Le);"success"===e.status?(Object.assign(Pe,Le),Ve.success("配置已保存")):Ve.error(e.message||"保存失败")}catch(e){Ve.error("保存配置失败")}}function Ie(){window.open("https://wxpusher.zjiecode.com/admin/login","_blank")}async function Oe(){if(ze.value===Ae.value)if(D(ze.value,6,63)){Me.value=!1,Ve.showLoading("正在应用密码修改");try{const e=await M(Se.value,ze.value);"success"===e.status?(Ve.success("密码修改成功，请重新登录"),await new Promise(e=>setTimeout(e,1500)),Se.value="",ze.value="",Ae.value="",await je.logout(),k.push("/login")):Ve.error(e.message||"修改失败")}catch(e){Ve.error("密码修改请求失败")}finally{Ve.hideLoading()}}else Ve.error("密码只能包含英文、数字和符号，长度6-63位");else Ve.error("两次输入的密码不一致")}function Be(){De.value=!0,Te.value="idle",qe.value={currentVersion:"",latestVersion:"",message:""}}function Ee(){"updating"!==Te.value&&(De.value=!1)}async function Fe(){Te.value="checking";try{const e=await S();"latest"===e.status?(Te.value="latest",qe.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message}):"available"===e.status?(Te.value="available",qe.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message}):(Te.value="error",qe.value.message=e.message||"检查更新失败")}catch(e){Te.value="error",qe.value.message="网络连接失败"}}async function Je(){Te.value="updating";try{const e=await z();"success"===e.status?(Te.value="success",qe.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message},setTimeout(()=>window.location.reload(),3e3)):(Te.value="error",qe.value.message=e.message||"更新失败")}catch(e){Te.value="error",qe.value.message="更新过程中出错"}}return s(async()=>{await async function(){try{const e=await async function(){return j.call("wx-wireless","get_settings",{})}();"success"===e.status?(Object.assign(Le,e),Object.assign(Pe,e)):Ve.error(e.message||"加载配置失败")}catch(e){Ve.error("加载配置失败")}}()}),(e,a)=>{const s=w("AlertTriangle");return g(),l(b,null,[t("div",J,[t("div",K,[t("div",N,[r(n(T),{class:"w-4 h-4 text-slate-400"})]),a[14]||(a[14]=t("div",null,[t("h2",{class:"text-lg font-bold text-white"},"系统配置"),t("p",{class:"text-[10px] text-slate-500 font-normal"},"System Settings")],-1))]),t("div",G,[t("div",Q,[t("div",R,[a[15]||(a[15]=t("label",{class:"form-label"},[t("span",null,"Ping 目标 IP")],-1)),u(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>Le.ping_target=e),type:"text",class:"input font-mono",placeholder:"223.5.5.5",autocomplete:"off"},null,512),[[o,Le.ping_target]]),a[16]||(a[16]=t("p",{class:"text-[10px] text-slate-500 mt-1"},"建议使用公共 DNS，如 223.5.5.5 (阿里)、119.29.29.29 (腾讯)",-1))]),t("div",W,[a[17]||(a[17]=t("label",{class:"form-label"},[t("span",null,"最大重试次数")],-1)),u(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>Le.auto_switch_max_retries=e),type:"number",class:"input",min:"1",autocomplete:"off"},null,512),[[o,Le.auto_switch_max_retries,void 0,{number:!0}]])]),t("div",X,[a[18]||(a[18]=t("label",{class:"form-label"},[t("span",null,"重试冷却时间 (秒)")],-1)),u(t("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>Le.retry_wifi_interval=e),type:"number",class:"input",min:"60",autocomplete:"off"},null,512),[[o,Le.retry_wifi_interval,void 0,{number:!0}]])]),t("div",Y,[a[19]||(a[19]=t("label",{class:"form-label"},[t("span",null,"重启阈值 (次)")],-1)),u(t("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>Le.restart_threshold=e),type:"number",class:"input",min:"1",autocomplete:"off"},null,512),[[o,Le.restart_threshold,void 0,{number:!0}]])]),1===Le.show_wxpusher?(g(),l("div",Z,[t("div",$,[t("div",ee,[r(n(I),{class:"w-3 h-3 text-accent-400"})]),t("div",ae,[a[21]||(a[21]=t("span",{class:"text-sm font-medium text-white"},"消息推送",-1)),t("button",{class:"inline-flex items-center gap-0.5 text-primary-400 hover:text-primary-300 ml-2 text-[10px]",onClick:Ie},[a[20]||(a[20]=c(" 获取配置 ",-1)),r(n(B),{class:"w-2.5 h-2.5"})])]),t("div",{class:i(["flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium transition-colors cursor-pointer select-none",1===Le.wxpusher_enabled?"bg-success-500/20 text-success-400":"bg-slate-700/50 text-slate-500"]),onClick:a[4]||(a[4]=e=>Le.wxpusher_enabled=1===Le.wxpusher_enabled?0:1)},[r(n(q),{class:"w-3 h-3"}),t("span",null,p(1===Le.wxpusher_enabled?"已开启":"已关闭"),1)],2)]),t("div",se,[t("div",le,[a[22]||(a[22]=t("label",{class:"form-label"},[t("span",null,"应用 Token")],-1)),t("div",te,[u(t("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>Le.wx_app_token=e),type:Ce.value?"text":"password",class:"input pr-10 font-mono text-sm",placeholder:"AT_xxxxxxxx"},null,8,re),[[v,Le.wx_app_token]]),t("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-300",onClick:a[6]||(a[6]=e=>Ce.value=!Ce.value)},[(g(),d(m(Ce.value?n(L):n(P)),{class:"w-4 h-4"}))])])]),t("div",ne,[a[23]||(a[23]=t("label",{class:"form-label"},[t("span",null,"用户 UID")],-1)),t("div",ue,[u(t("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>Le.wx_my_uid=e),type:Ue.value?"text":"password",class:"input pr-10 font-mono text-sm",placeholder:"UID_xxxxxxxx"},null,8,oe),[[v,Le.wx_my_uid]]),t("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-300",onClick:a[8]||(a[8]=e=>Ue.value=!Ue.value)},[(g(),d(m(Ue.value?n(L):n(P)),{class:"w-4 h-4"}))])])])])])):x("",!0),t("div",ce,[t("button",{class:"btn btn-primary w-full",onClick:He},[r(n(A),{class:"w-4 h-4"}),a[24]||(a[24]=t("span",null,"保存配置",-1))])])])]),t("div",ie,[t("div",pe,[t("button",{class:"btn btn-ghost",onClick:a[9]||(a[9]=e=>Me.value=!0)},[r(n(E),{class:"w-4 h-4"}),a[25]||(a[25]=t("span",null,"修改密码",-1))]),t("button",{class:"btn btn-ghost",onClick:Be},[r(n(O),{class:"w-4 h-4"}),a[26]||(a[26]=t("span",null,"系统更新",-1))])])])]),r(C,{visible:Me.value,title:"修改密码",icon:n(E),onClose:a[13]||(a[13]=e=>Me.value=!1)},{footer:h(()=>[t("button",{class:"btn btn-primary flex-1",onClick:Oe},[r(n(F),{class:"w-4 h-4"}),a[30]||(a[30]=c(" 确定修改 ",-1))])]),default:h(()=>[t("div",ve,[t("div",de,[t("label",me,[r(n(H),{class:"w-4 h-4"}),a[27]||(a[27]=t("span",null,"当前密码",-1))]),u(t("input",{"onUpdate:modelValue":a[10]||(a[10]=e=>Se.value=e),type:"password",class:"input",placeholder:"请输入当前密码",autocomplete:"off"},null,512),[[o,Se.value]])]),t("div",xe,[t("label",he,[r(n(E),{class:"w-4 h-4"}),a[28]||(a[28]=t("span",null,"新密码",-1))]),u(t("input",{"onUpdate:modelValue":a[11]||(a[11]=e=>ze.value=e),type:"password",class:"input",placeholder:"请输入新密码（至少6位）",autocomplete:"new-password"},null,512),[[o,ze.value]])]),t("div",be,[t("label",fe,[r(n(F),{class:"w-4 h-4"}),a[29]||(a[29]=t("span",null,"确认新密码",-1))]),u(t("input",{"onUpdate:modelValue":a[12]||(a[12]=e=>Ae.value=e),type:"password",class:"input",placeholder:"请再次输入新密码",autocomplete:"new-password"},null,512),[[o,Ae.value]])])])]),_:1},8,["visible","icon"]),r(C,{visible:De.value,title:"系统更新",icon:n(O),onClose:Ee},{footer:h(()=>[t("div",_e,["idle"===Te.value?(g(),l("button",{key:0,class:"btn btn-primary w-full h-full",onClick:Fe},"检查更新")):"available"===Te.value?(g(),l("button",{key:1,class:"btn btn-primary w-full h-full",onClick:Je},"立即更新")):"error"===Te.value?(g(),l("button",{key:2,class:"btn btn-primary w-full h-full",onClick:Fe},"重试")):x("",!0)])]),default:h(()=>[t("div",ge,[t("div",{class:i(["w-14 h-14 rounded-full flex items-center justify-center mb-3",{"bg-primary-500/10":"idle"===Te.value,"bg-slate-700/50":"checking"===Te.value,"bg-success-500/10":"latest"===Te.value||"success"===Te.value,"bg-accent-500/10":"available"===Te.value||"updating"===Te.value,"bg-danger-500/10":"error"===Te.value}])},["checking"===Te.value||"updating"===Te.value?(g(),l("div",{key:0,class:i(["w-6 h-6 border-2 border-t-transparent rounded-full animate-spin","checking"===Te.value?"border-primary-400":"border-accent-400"])},null,2)):"idle"===Te.value||"available"===Te.value?(g(),d(n(O),{key:1,class:i(["w-6 h-6","idle"===Te.value?"text-primary-400":"text-accent-400"])},null,8,["class"])):"latest"===Te.value||"success"===Te.value?(g(),d(n(U),{key:2,class:"w-6 h-6 text-success-400"})):"error"===Te.value?(g(),d(s,{key:3,class:"w-6 h-6 text-danger-400"})):x("",!0)],2),t("p",{class:i(["font-medium text-base",{"text-slate-300":"idle"===Te.value||"checking"===Te.value||"updating"===Te.value,"text-success-400":"latest"===Te.value||"success"===Te.value,"text-accent-400":"available"===Te.value,"text-danger-400":"error"===Te.value}])},p("idle"===Te.value?"检查系统更新":"checking"===Te.value?"正在检查...":"latest"===Te.value?"已是最新版本":"available"===Te.value?"发现新版本":"updating"===Te.value?"正在更新...":"success"===Te.value?"更新成功":"更新失败"),3),t("p",ye,["idle"===Te.value?(g(),l(b,{key:0},[c("点击下方按钮检查更新")],64)):"checking"===Te.value?(g(),l(b,{key:1},[c("正在连接服务器")],64)):"latest"===Te.value?(g(),l(b,{key:2},[c(p(qe.value.currentVersion),1)],64)):"available"===Te.value?(g(),l(b,{key:3},[t("span",we,p(qe.value.currentVersion),1),a[31]||(a[31]=t("span",{class:"mx-1"},"→",-1)),t("span",ke,p(qe.value.latestVersion),1)],64)):"updating"===Te.value?(g(),l(b,{key:4},[c("更新期间请勿断开电源")],64)):"success"===Te.value?(g(),l(b,{key:5},[c("即将自动刷新")],64)):"error"===Te.value?(g(),l(b,{key:6},[c(p(qe.value.message),1)],64)):x("",!0)])])]),_:1},8,["visible","icon"])],64)}}});export{Ve as default};
