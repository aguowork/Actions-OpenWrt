import{e,v as a,j as s,g as t,i as l,u as n,w as i,T as c,B as o,m as r,F as u,r as d,o as v,C as p,t as m,f,l as h,k as y,I as g,z as b,A as x}from"./vue-vendor.js";import{u as w}from"./wireless2.js";import{c as k,u as S,a as _,T as C,_ as j}from"./index.js";import{D as V}from"./Dialog.js";import{E as M,a as L,i as T}from"./validation.js";import{W as P}from"./wifi.js";import{L as q}from"./lock.js";import{R as z}from"./radio.js";import{A as I}from"./activity.js";import{P as N}from"./power.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=k("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),R=k("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),U=k("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),A=k("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),B=k("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),H=k("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),D=k("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),E=k("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */async function F(e,a="GET",s){const t=localStorage.getItem("wx_auth_token"),l={};t&&(l.Authorization=t),s&&(l["Content-Type"]="application/json");const n=await fetch(`/cgi-bin/wx-auth.sh?action=${e}`,{method:a,headers:l,body:s?JSON.stringify(s):void 0});return await n.json()}const W={class:"space-y-4"},G={class:"flex items-center gap-3 px-1"},J={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500/20 to-primary-600/10 flex items-center justify-center"},$={class:"card space-y-3"},K={class:"info-row"},Q={class:"info-label"},X={class:"info-value"},Y={key:0,class:"font-medium"},Z={class:"info-label"},ee={class:"info-value"},ae={key:0,class:"flex items-center gap-2"},se={class:"font-mono"},te={class:"info-row"},le={class:"info-label"},ne={class:"info-value"},ie={key:0,class:"badge uppercase"},ce={class:"info-row"},oe={class:"info-label"},re={class:"info-value"},ue={class:"info-row"},de={class:"info-label"},ve={class:"info-value"},pe={key:0,class:"flex items-center gap-2"},me={class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none"},fe={class:"info-row"},he={class:"info-label"},ye={class:"info-value"},ge={class:"card"},be={class:"flex items-center justify-between mb-4 h-9"},xe={class:"flex items-center gap-3"},we={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-warning-500/20 to-warning-600/10 flex items-center justify-center"},ke=["disabled"],Se={class:"space-y-3"},_e={class:"info-row"},Ce={class:"info-label"},je={class:"info-value"},Ve={class:"info-row"},Me={class:"info-label"},Le={class:"info-value font-medium"},Te={key:0},Pe={class:"info-row"},qe={class:"info-label"},ze={class:"info-value font-medium"},Ie={key:0},Ne={key:0,class:"p-3 rounded-xl bg-warning-500/10 border border-warning-500/20"},Oe={class:"flex items-start gap-3"},Re={class:"card"},Ue={class:"grid grid-cols-2 lg:grid-cols-4 gap-3"},Ae={class:"flex items-start gap-4 p-4 rounded-xl bg-danger-500/10 border border-danger-500/20"},Be={class:"space-y-4"},He={class:"form-group"},De={class:"form-label"},Ee={class:"form-group"},Fe={class:"form-label"},We={class:"form-group"},Ge={class:"form-label"},Je={class:"h-[160px] flex flex-col items-center justify-center text-center"},$e={class:"text-xs text-slate-500 mt-1"},Ke={class:"text-slate-400"},Qe={class:"text-accent-400"},Xe={class:"w-full h-[42px]"},Ye=j(e({__name:"Status",setup(e){const k=p(),j=w(),Ye=S(),Ze=_(),ea=d(!1),aa=d(!1),sa=d(!1),ta=d(!1),la=d("idle"),na=d({currentVersion:"",latestVersion:"",message:""}),ia=d(""),ca=d(""),oa=d("");async function ra(e=!0){e&&Ze.showLoading();try{await Promise.all([j.fetchConnectionStatus(),j.fetchRetryStatus()])}finally{Ze.hideLoading()}j.error&&Ze.error(j.error)}function ua(){ea.value=!ea.value}async function da(){aa.value=!1,Ze.showLoading();try{const e=await async function(){return F("reboot","POST")}();"success"===e.status?Ze.startCountdown(60,()=>{Ze.hideLoading(),k.push("/login")}):(Ze.hideLoading(),Ze.error(e.message||"重启失败"))}catch(e){Ze.hideLoading(),Ze.error("重启请求失败")}}async function va(){await j.resetRetryCount()?(Ze.success("重试计数已重置"),await j.fetchRetryStatus()):Ze.error(j.error||"重置失败")}async function pa(){if(ca.value===oa.value)if(T(ca.value,6,63)){sa.value=!1,Ze.showLoading("正在应用密码修改");try{const e=await async function(e,a){return F("change","POST",{oldPassword:e,newPassword:a})}(ia.value,ca.value);"success"===e.status?(Ze.success("密码修改成功，请重新登录"),await new Promise(e=>setTimeout(e,1500)),ia.value="",ca.value="",oa.value="",await Ye.logout(),k.push("/login")):Ze.error(e.message||"修改失败")}catch(e){Ze.error("密码修改请求失败")}finally{Ze.hideLoading()}}else Ze.error("密码只能包含英文、数字和符号，长度6-63位");else Ze.error("两次输入的密码不一致")}function ma(){ta.value=!0,la.value="idle",na.value={currentVersion:"",latestVersion:"",message:""}}function fa(){"updating"!==la.value&&(ta.value=!1)}async function ha(){la.value="checking";try{const e=await async function(){return F("checkUpdate","POST")}();"latest"===e.status?(la.value="latest",na.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message}):"available"===e.status?(la.value="available",na.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message}):(la.value="error",na.value.message=e.message||"检查更新失败")}catch(e){la.value="error",na.value.message="网络连接失败"}}async function ya(){la.value="updating";try{const e=await async function(){return F("doUpdate","POST")}();"success"===e.status?(la.value="success",na.value={currentVersion:e.current_version,latestVersion:e.latest_version,message:e.message},setTimeout(()=>{window.location.reload()},3e3)):(la.value="error",na.value.message=e.message||"更新失败")}catch(e){la.value="error",na.value.message="更新过程中出错"}}function ga(e){if(!e)return"status-disconnected";const a=parseInt(e);return isNaN(a)?"status-disconnected":a>=-65?"status-connected":a>=-75?"status-warning":"status-disconnected"}function ba(e){if(!e)return{level:0,hex:"#64748b"};const a=parseInt(e);return isNaN(a)?{level:0,hex:"#64748b"}:a>=-50?{level:3,hex:"#4ade80"}:a>=-65?{level:2,hex:"#4ade80"}:a>=-75?{level:1,hex:"#fbbf24"}:{level:0,hex:"#f87171"}}return a(()=>{Ze.loadingText="正在同步设备状态",ra(!1)}),(e,a)=>(v(),s(u,null,[t("div",W,[t("div",G,[t("div",J,[l(n(P),{class:"w-4 h-4 text-primary-400"})]),a[8]||(a[8]=t("div",null,[t("h2",{class:"text-lg font-bold text-white"},"连接状态"),t("p",{class:"text-[10px] text-slate-500 font-normal"},"Connection Status")],-1))]),t("div",$,[t("div",K,[t("div",Q,[l(n(P),{class:"w-4 h-4 text-primary-400"}),a[9]||(a[9]=t("span",null,"名称",-1))]),t("div",X,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).connectionStatus?(v(),s("span",Y,m(n(j).connectionStatus.ssid),1)):r("",!0)]),_:1})])]),t("div",{class:"info-row cursor-pointer group",onClick:ua},[t("div",Z,[l(n(q),{class:"w-4 h-4 text-primary-400"}),a[10]||(a[10]=t("span",null,"密码",-1))]),t("div",ee,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).connectionStatus?(v(),s("div",ae,[t("span",se,m(ea.value?n(j).connectionStatus.key:"••••••••"),1),(v(),f(h(ea.value?n(M):n(L)),{class:"w-4 h-4 text-slate-500 group-hover:text-primary-400 transition-colors"}))])):r("",!0)]),_:1})])]),t("div",te,[t("div",le,[l(n(z),{class:"w-4 h-4 text-primary-400"}),a[11]||(a[11]=t("span",null,"频段",-1))]),t("div",ne,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).connectionStatus?(v(),s("span",ie,m(n(j).connectionStatus.band),1)):r("",!0)]),_:1})])]),t("div",ce,[t("div",oe,[l(n(B),{class:"w-4 h-4 text-primary-400"}),a[12]||(a[12]=t("span",null,"接口",-1))]),t("div",re,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).connectionStatus?(v(),s("span",{key:0,class:y(["status-tag",n(j).connectionStatus.interface.includes("不存在")?"status-disconnected":"status-connected"])},m(n(j).connectionStatus.interface),3)):r("",!0)]),_:1})])]),t("div",ue,[t("div",de,[l(n(O),{class:"w-4 h-4 text-primary-400"}),a[13]||(a[13]=t("span",null,"状态",-1))]),t("div",ve,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).connectionStatus?(v(),s("div",pe,[t("span",{class:y(["status-tag",n(j).connectionStatus.bridge_status.includes("成功")?"status-connected":"status-disconnected"])},m(n(j).connectionStatus.bridge_status.includes("成功")?"连接成功":"连接失败"),3),n(j).connectionStatus.bridge_status.includes("成功")&&n(j).connectionStatus.signal?(v(),s("span",{key:0,class:y(["status-tag flex items-center gap-1.5",ga(n(j).connectionStatus.signal)])},[(v(),s("svg",me,[t("circle",{cx:"12",cy:"19",r:"2",style:g({fill:ba(n(j).connectionStatus.signal).hex})},null,4),t("path",{d:"M8.5 15.5C9.5 14.5 10.7 14 12 14s2.5.5 3.5 1.5",style:g({stroke:ba(n(j).connectionStatus.signal).level>=1?ba(n(j).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),t("path",{d:"M5.5 12.5C7.3 10.7 9.5 10 12 10s4.7.7 6.5 2.5",style:g({stroke:ba(n(j).connectionStatus.signal).level>=2?ba(n(j).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),t("path",{d:"M2.5 9.5C5.2 6.8 8.4 6 12 6s6.8.8 9.5 3.5",style:g({stroke:ba(n(j).connectionStatus.signal).level>=3?ba(n(j).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4)])),o(" "+m(n(j).connectionStatus.signal)+" dBm ",1)],2)):r("",!0)])):r("",!0)]),_:1})])]),t("div",fe,[t("div",he,[l(n(U),{class:"w-4 h-4 text-primary-400"}),a[14]||(a[14]=t("span",null,"网络",-1))]),t("div",ye,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).connectionStatus?(v(),s("span",{key:0,class:y(["status-tag","连接成功"===n(j).connectionStatus.network_status?"status-connected":"status-disconnected"])},m(n(j).connectionStatus.network_status),3)):r("",!0)]),_:1})])])]),t("div",ge,[t("div",be,[t("div",xe,[t("div",we,[l(n(I),{class:"w-4 h-4 text-warning-400"})]),a[15]||(a[15]=t("div",null,[t("h3",{class:"text-lg font-bold text-white"},"重试保护"),t("p",{class:"text-[10px] text-slate-500 font-normal"},"Retry Protection")],-1))]),n(j).retryStatus&&n(j).retryStatus.cq_times>0?(v(),s("button",{key:0,class:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-warning-500/10 text-warning-400 text-xs font-medium hover:bg-warning-500/20 transition-colors",onClick:va,disabled:n(j).isLoading},[l(n(D),{class:"w-3.5 h-3.5"}),a[16]||(a[16]=o(" 重置 ",-1))],8,ke)):r("",!0)]),t("div",Se,[t("div",_e,[t("div",Ce,[l(n(D),{class:"w-4 h-4 text-warning-400"}),a[17]||(a[17]=t("span",null,"失败次数",-1))]),t("div",je,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).retryStatus?(v(),s("span",{key:0,class:y(["status-tag",n(j).retryStatus.cq_times>=n(j).retryStatus.restart_threshold?"status-warning":"status-connected"])},[n(j).retryStatus.cq_times>=n(j).retryStatus.restart_threshold?(v(),f(n(C),{key:0,class:"w-3.5 h-3.5"})):r("",!0),o(" "+m(n(j).retryStatus.cq_times)+" / "+m(n(j).retryStatus.restart_threshold),1)],2)):r("",!0)]),_:1})])]),t("div",Ve,[t("div",Me,[l(n(I),{class:"w-4 h-4 text-primary-400"}),a[18]||(a[18]=t("span",null,"最大重试",-1))]),t("div",Le,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).retryStatus?(v(),s("span",Te,m(n(j).retryStatus.max_retries)+" 次",1)):r("",!0)]),_:1})])]),t("div",Pe,[t("div",qe,[l(n(C),{class:"w-4 h-4 text-primary-400"}),a[19]||(a[19]=t("span",null,"重启阈值",-1))]),t("div",ze,[l(c,{name:"fade",mode:"out-in"},{default:i(()=>[n(j).retryStatus?(v(),s("span",Ie,m(n(j).retryStatus.restart_threshold)+" 次",1)):r("",!0)]),_:1})])]),n(j).retryStatus&&n(j).retryStatus.cq_times>=n(j).retryStatus.restart_threshold?(v(),s("div",Ne,[t("div",Oe,[l(n(C),{class:"w-4 h-4 text-warning-400 flex-shrink-0 mt-0.5"}),a[20]||(a[20]=t("div",{class:"text-sm"},[t("p",{class:"text-warning-300 font-medium mb-1"},"即将自动重启"),t("p",{class:"text-slate-400 text-xs"},"重试失败次数过多，为防止无线网卡卡死，系统将自动重启设备。")],-1))])])):r("",!0)])]),t("div",Re,[t("div",Ue,[t("button",{class:"btn btn-ghost",onClick:a[0]||(a[0]=e=>sa.value=!0)},[l(n(A),{class:"w-4 h-4"}),a[21]||(a[21]=t("span",null,"修改密码",-1))]),t("button",{class:"btn btn-ghost",onClick:ma},[l(n(R),{class:"w-4 h-4"}),a[22]||(a[22]=t("span",null,"系统更新",-1))]),t("button",{class:"btn btn-ghost text-danger-400 hover:bg-danger-500/10",onClick:a[1]||(a[1]=e=>aa.value=!0)},[l(n(N),{class:"w-4 h-4"}),a[23]||(a[23]=t("span",null,"重启系统",-1))]),t("button",{class:"btn btn-primary",onClick:a[2]||(a[2]=e=>ra(!0))},[l(n(H),{class:"w-4 h-4"}),a[24]||(a[24]=t("span",null,"刷新状态",-1))])])])]),l(V,{visible:aa.value,title:"重启确认",icon:n(N),onClose:a[3]||(a[3]=e=>aa.value=!1)},{footer:i(()=>[t("button",{class:"btn btn-danger flex-1",onClick:da},[l(n(N),{class:"w-4 h-4"}),a[26]||(a[26]=o(" 确定重启 ",-1))])]),default:i(()=>[t("div",Ae,[l(n(C),{class:"w-5 h-5 text-danger-400 flex-shrink-0 mt-0.5"}),a[25]||(a[25]=t("div",{class:"text-sm text-slate-300"},[t("p",{class:"font-medium text-danger-400 mb-1"},"确定要重启系统吗？"),t("p",{class:"text-slate-400"},"系统重启期间，WiFi连接将会断开。")],-1))])]),_:1},8,["visible","icon"]),l(V,{visible:sa.value,title:"修改密码",icon:n(A),onClose:a[7]||(a[7]=e=>sa.value=!1)},{footer:i(()=>[t("button",{class:"btn btn-primary flex-1",onClick:pa},[l(n(E),{class:"w-4 h-4"}),a[30]||(a[30]=o(" 确定修改 ",-1))])]),default:i(()=>[t("div",Be,[t("div",He,[t("label",De,[l(n(q),{class:"w-4 h-4"}),a[27]||(a[27]=t("span",null,"当前密码",-1))]),b(t("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>ia.value=e),type:"password",class:"input",placeholder:"请输入当前密码"},null,512),[[x,ia.value]])]),t("div",Ee,[t("label",Fe,[l(n(A),{class:"w-4 h-4"}),a[28]||(a[28]=t("span",null,"新密码",-1))]),b(t("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>ca.value=e),type:"password",class:"input",placeholder:"请输入新密码（至少6位）"},null,512),[[x,ca.value]])]),t("div",We,[t("label",Ge,[l(n(E),{class:"w-4 h-4"}),a[29]||(a[29]=t("span",null,"确认新密码",-1))]),b(t("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>oa.value=e),type:"password",class:"input",placeholder:"请再次输入新密码"},null,512),[[x,oa.value]])])])]),_:1},8,["visible","icon"]),l(V,{visible:ta.value,title:"系统更新",icon:n(R),onClose:fa},{footer:i(()=>[t("div",Xe,["idle"===la.value?(v(),s("button",{key:0,class:"btn btn-primary w-full h-full",onClick:ha},"检查更新")):"available"===la.value?(v(),s("button",{key:1,class:"btn btn-primary w-full h-full",onClick:ya},"立即更新")):"error"===la.value?(v(),s("button",{key:2,class:"btn btn-primary w-full h-full",onClick:ha},"重试")):r("",!0)])]),default:i(()=>[t("div",Je,[t("div",{class:y(["w-14 h-14 rounded-full flex items-center justify-center mb-3",{"bg-primary-500/10":"idle"===la.value,"bg-slate-700/50":"checking"===la.value,"bg-success-500/10":"latest"===la.value||"success"===la.value,"bg-accent-500/10":"available"===la.value||"updating"===la.value,"bg-danger-500/10":"error"===la.value}])},["checking"===la.value||"updating"===la.value?(v(),s("div",{key:0,class:y(["w-6 h-6 border-2 border-t-transparent rounded-full animate-spin","checking"===la.value?"border-primary-400":"border-accent-400"])},null,2)):"idle"===la.value||"available"===la.value?(v(),f(n(R),{key:1,class:y(["w-6 h-6","idle"===la.value?"text-primary-400":"text-accent-400"])},null,8,["class"])):"latest"===la.value||"success"===la.value?(v(),f(n(O),{key:2,class:"w-6 h-6 text-success-400"})):"error"===la.value?(v(),f(n(C),{key:3,class:"w-6 h-6 text-danger-400"})):r("",!0)],2),t("p",{class:y(["font-medium text-base",{"text-slate-300":"idle"===la.value||"checking"===la.value||"updating"===la.value,"text-success-400":"latest"===la.value||"success"===la.value,"text-accent-400":"available"===la.value,"text-danger-400":"error"===la.value}])},m("idle"===la.value?"检查系统更新":"checking"===la.value?"正在检查...":"latest"===la.value?"已是最新版本":"available"===la.value?"发现新版本":"updating"===la.value?"正在更新...":"success"===la.value?"更新成功":"更新失败"),3),t("p",$e,["idle"===la.value?(v(),s(u,{key:0},[o("点击下方按钮检查更新")],64)):"checking"===la.value?(v(),s(u,{key:1},[o("正在连接服务器")],64)):"latest"===la.value?(v(),s(u,{key:2},[o(m(na.value.currentVersion),1)],64)):"available"===la.value?(v(),s(u,{key:3},[t("span",Ke,m(na.value.currentVersion),1),a[31]||(a[31]=t("span",{class:"mx-1"},"→",-1)),t("span",Qe,m(na.value.latestVersion),1)],64)):"updating"===la.value?(v(),s(u,{key:4},[o("更新期间请勿断开电源")],64)):"success"===la.value?(v(),s(u,{key:5},[o("即将自动刷新")],64)):"error"===la.value?(v(),s(u,{key:6},[o(m(na.value.message),1)],64)):r("",!0)])])]),_:1},8,["visible","icon"])],64))}}),[["__scopeId","data-v-6057d0ac"]]);export{Ye as default};
