import{e as t,v as s,j as e,g as a,i as n,u as l,y as i,k as o,t as c,w as r,T as d,B as u,m as v,F as f,r as p,o as m,C as h,f as g,l as y,I as x}from"./vue-vendor.js";import{u as b}from"./wireless2.js";import{c as w,a as k,T as S,_}from"./index.js";import{D as C}from"./Dialog.js";import{C as j,r as L}from"./system.js";import{d as M,g as q}from"./wireless3.js";import{W as I}from"./wifi.js";import{P as R}from"./power.js";import{L as T}from"./lock.js";import{R as N}from"./radio.js";import{A as W}from"./activity.js";import{E as A,a as B}from"./eye.js";
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=w("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),D=w("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),F=w("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),H=w("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),O={class:"space-y-4"},z={class:"card"},E={class:"flex items-center justify-between mb-5"},$={class:"flex items-center gap-3"},G={class:"w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500/20 to-primary-600/10 flex items-center justify-center"},J={class:"py-6 text-center text-slate-500"},K={class:"space-y-3 pt-1"},Q={class:"info-row"},U={class:"info-label"},V={class:"info-value"},X={key:0,class:"font-medium"},Y={class:"info-label"},Z={class:"info-value"},tt={key:0,class:"flex items-center gap-2"},st={class:"font-mono"},et={class:"info-row"},at={class:"info-label"},nt={class:"info-value"},lt={key:0,class:"badge uppercase"},it={class:"info-row"},ot={class:"info-label"},ct={class:"info-value"},rt={class:"info-row"},dt={class:"info-label"},ut={class:"info-value"},vt={key:0,class:"flex items-center gap-2"},ft={class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none"},pt={class:"info-row"},mt={class:"info-label"},ht={class:"info-value"},gt={class:"card"},yt={class:"flex items-center justify-between mb-4 h-9"},xt={class:"flex items-center gap-3"},bt={class:"w-9 h-9 rounded-xl bg-gradient-to-br from-warning-500/20 to-warning-600/10 flex items-center justify-center"},wt=["disabled"],kt={class:"space-y-3"},St={class:"info-row"},_t={class:"info-label"},Ct={class:"info-value"},jt={class:"info-row"},Lt={class:"info-label"},Mt={class:"info-value font-medium"},qt={key:0},It={class:"info-row"},Rt={class:"info-label"},Tt={class:"info-value font-medium"},Nt={key:0},Wt={key:0,class:"p-3 rounded-xl bg-warning-500/10 border border-warning-500/20"},At={class:"flex items-start gap-3"},Bt={class:"card"},Pt={class:"grid grid-cols-2 gap-3"},Dt={class:"flex items-start gap-4 p-4 rounded-xl bg-danger-500/10 border border-danger-500/20"},Ft={class:"flex gap-3 w-full"},Ht={class:"space-y-4"},Ot={class:"p-4 rounded-xl bg-warning-500/10 border border-warning-500/20"},zt={class:"flex items-start gap-3"},Et={class:"text-sm"},$t={class:"text-warning-300 font-medium mb-2"},Gt=_(t({__name:"Status",setup(t){const w=h(),_=b(),Gt=k(),Jt=p(!1),Kt=p(!1),Qt=p(!1),Ut=p(!1);async function Vt(t=!0){t&&Gt.showLoading();try{await Promise.all([_.fetchConnectionStatus(),_.fetchRetryStatus()])}finally{Gt.hideLoading()}_.error&&Gt.error(_.error)}function Xt(){Jt.value=!Jt.value}async function Yt(){Kt.value=!1,Gt.showLoading();try{const t=await L();"success"===t.status?Gt.startCountdown(60,()=>{Gt.hideLoading(),w.push("/login")}):(Gt.hideLoading(),Gt.error(t.message||"重启失败"))}catch(t){Gt.hideLoading(),Gt.error("重启请求失败")}}async function Zt(){await _.resetRetryCount()?(Gt.success("重试计数已重置"),await _.fetchRetryStatus()):Gt.error(_.error||"重置失败")}function ts(t){if(!t)return"status-disconnected";const s=parseInt(t);return isNaN(s)?"status-disconnected":s>=-65?"status-connected":s>=-75?"status-warning":"status-disconnected"}function ss(t){if(!t)return{level:0,hex:"#64748b"};const s=parseInt(t);return isNaN(s)?{level:0,hex:"#64748b"}:s>=-50?{level:3,hex:"#4ade80"}:s>=-65?{level:2,hex:"#4ade80"}:s>=-75?{level:1,hex:"#fbbf24"}:{level:0,hex:"#f87171"}}function es(){window.open("http://"+window.location.hostname+"/cgi-bin/luci/admin/network/wireless","_blank")}s(async()=>{var t;Gt.loadingText="正在同步设备状态",await Vt(!1),(null==(t=_.connectionStatus)?void 0:t.sta_count)&&_.connectionStatus.sta_count>1&&(Qt.value=!0)});let as=null,ns=null,ls=p(0);function is(){as&&(clearInterval(as),as=null),ns&&(clearInterval(ns),ns=null)}async function os(){Ut.value=!1,Gt.showLoading("正在关闭中继模式"),M().catch(()=>{}),ls.value=60,as=setInterval(()=>{ls.value--,Gt.loadingText=`正在关闭中继模式 (${ls.value}s)`,30!==ls.value||ns||(ns=setInterval(async()=>{try{(await q()).relay_enabled||(is(),Gt.hideLoading(),Gt.success("中继模式已关闭"),Vt(!1))}catch{}},3e3)),ls.value<=0&&(is(),Gt.hideLoading(),Vt(!1))},1e3)}function cs(){var t;(null==(t=_.connectionStatus)?void 0:t.relay_enabled)?Ut.value=!0:w.push("/connect")}return(t,s)=>{var p,h,b,w;return m(),e(f,null,[a("div",O,[a("div",z,[a("div",E,[a("div",$,[a("div",G,[n(l(I),{class:"w-5 h-5 text-primary-400"})]),s[5]||(s[5]=a("div",null,[a("h2",{class:"text-lg font-bold text-white"},"中继模式"),a("p",{class:"text-xs text-slate-500"},"Relay Mode")],-1))]),a("div",{class:o(["flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-colors cursor-pointer select-none touch-manipulation",(null==(p=l(_).connectionStatus)?void 0:p.relay_enabled)?"bg-success-500/20 text-success-400":"bg-slate-700/50 text-slate-500"]),onClick:i(cs,["stop","prevent"]),style:{"-webkit-tap-highlight-color":"transparent"}},[n(l(R),{class:"w-4 h-4"}),a("span",null,c((null==(h=l(_).connectionStatus)?void 0:h.relay_enabled)?"已开启":"已关闭"),1)],2)]),a("div",{class:o(["grid-wrapper",{open:!1===(null==(b=l(_).connectionStatus)?void 0:b.relay_enabled),"transition-enabled":!0}])},[a("div",null,[a("div",J,[n(l(I),{class:"w-8 h-8 mx-auto mb-2 opacity-50"}),s[6]||(s[6]=a("p",null,"无线中继已关闭",-1))])])],2),a("div",{class:o(["grid-wrapper",{open:!1!==(null==(w=l(_).connectionStatus)?void 0:w.relay_enabled),"transition-enabled":!0}])},[a("div",null,[a("div",K,[a("div",Q,[a("div",U,[n(l(I),{class:"w-4 h-4 text-primary-400"}),s[7]||(s[7]=a("span",null,"名称",-1))]),a("div",V,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).connectionStatus?(m(),e("span",X,c(l(_).connectionStatus.ssid),1)):v("",!0)]),_:1})])]),a("div",{class:"info-row cursor-pointer group",onClick:Xt},[a("div",Y,[n(l(T),{class:"w-4 h-4 text-primary-400"}),s[8]||(s[8]=a("span",null,"密码",-1))]),a("div",Z,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).connectionStatus?(m(),e("div",tt,[a("span",st,c(Jt.value?l(_).connectionStatus.key:"••••••••"),1),(m(),g(y(Jt.value?l(A):l(B)),{class:"w-4 h-4 text-slate-500 group-hover:text-primary-400 transition-colors"}))])):v("",!0)]),_:1})])]),a("div",et,[a("div",at,[n(l(N),{class:"w-4 h-4 text-primary-400"}),s[9]||(s[9]=a("span",null,"频段",-1))]),a("div",nt,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).connectionStatus?(m(),e("span",lt,c(l(_).connectionStatus.band),1)):v("",!0)]),_:1})])]),a("div",it,[a("div",ot,[n(l(D),{class:"w-4 h-4 text-primary-400"}),s[10]||(s[10]=a("span",null,"接口",-1))]),a("div",ct,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).connectionStatus?(m(),e("span",{key:0,class:o(["status-tag",l(_).connectionStatus.interface.includes("不存在")?"status-disconnected":"status-connected"])},c(l(_).connectionStatus.interface),3)):v("",!0)]),_:1})])]),a("div",rt,[a("div",dt,[n(l(j),{class:"w-4 h-4 text-primary-400"}),s[11]||(s[11]=a("span",null,"状态",-1))]),a("div",ut,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).connectionStatus?(m(),e("div",vt,[a("span",{class:o(["status-tag",l(_).connectionStatus.bridge_status.includes("成功")?"status-connected":"status-disconnected"])},c(l(_).connectionStatus.bridge_status.includes("成功")?"连接成功":"连接失败"),3),l(_).connectionStatus.bridge_status.includes("成功")&&l(_).connectionStatus.signal?(m(),e("span",{key:0,class:o(["status-tag flex items-center gap-1.5",ts(l(_).connectionStatus.signal)])},[(m(),e("svg",ft,[a("circle",{cx:"12",cy:"19",r:"2",style:x({fill:ss(l(_).connectionStatus.signal).hex})},null,4),a("path",{d:"M8.5 15.5C9.5 14.5 10.7 14 12 14s2.5.5 3.5 1.5",style:x({stroke:ss(l(_).connectionStatus.signal).level>=1?ss(l(_).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),a("path",{d:"M5.5 12.5C7.3 10.7 9.5 10 12 10s4.7.7 6.5 2.5",style:x({stroke:ss(l(_).connectionStatus.signal).level>=2?ss(l(_).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4),a("path",{d:"M2.5 9.5C5.2 6.8 8.4 6 12 6s6.8.8 9.5 3.5",style:x({stroke:ss(l(_).connectionStatus.signal).level>=3?ss(l(_).connectionStatus.signal).hex:"#475569"}),"stroke-width":"2","stroke-linecap":"round"},null,4)])),u(" "+c(l(_).connectionStatus.signal)+" dBm ",1)],2)):v("",!0)])):v("",!0)]),_:1})])]),a("div",pt,[a("div",mt,[n(l(P),{class:"w-4 h-4 text-primary-400"}),s[12]||(s[12]=a("span",null,"网络",-1))]),a("div",ht,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).connectionStatus?(m(),e("span",{key:0,class:o(["status-tag","连接成功"===l(_).connectionStatus.network_status?"status-connected":"status-disconnected"])},c(l(_).connectionStatus.network_status),3)):v("",!0)]),_:1})])])])])],2)]),a("div",gt,[a("div",yt,[a("div",xt,[a("div",bt,[n(l(W),{class:"w-4 h-4 text-warning-400"})]),s[13]||(s[13]=a("div",null,[a("h3",{class:"text-lg font-bold text-white"},"重试保护"),a("p",{class:"text-[10px] text-slate-500 font-normal"},"Retry Protection")],-1))]),l(_).retryStatus&&l(_).retryStatus.cq_times>0?(m(),e("button",{key:0,class:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-warning-500/10 text-warning-400 text-xs font-medium hover:bg-warning-500/20 transition-colors",onClick:Zt,disabled:l(_).isLoading},[n(l(H),{class:"w-3.5 h-3.5"}),s[14]||(s[14]=u(" 重置 ",-1))],8,wt)):v("",!0)]),a("div",kt,[a("div",St,[a("div",_t,[n(l(H),{class:"w-4 h-4 text-warning-400"}),s[15]||(s[15]=a("span",null,"失败次数",-1))]),a("div",Ct,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).retryStatus?(m(),e("span",{key:0,class:o(["status-tag",l(_).retryStatus.cq_times>=l(_).retryStatus.restart_threshold?"status-warning":"status-connected"])},[l(_).retryStatus.cq_times>=l(_).retryStatus.restart_threshold?(m(),g(l(S),{key:0,class:"w-3.5 h-3.5"})):v("",!0),u(" "+c(l(_).retryStatus.cq_times)+" / "+c(l(_).retryStatus.restart_threshold),1)],2)):v("",!0)]),_:1})])]),a("div",jt,[a("div",Lt,[n(l(W),{class:"w-4 h-4 text-primary-400"}),s[16]||(s[16]=a("span",null,"最大重试",-1))]),a("div",Mt,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).retryStatus?(m(),e("span",qt,c(l(_).retryStatus.max_retries)+" 次",1)):v("",!0)]),_:1})])]),a("div",It,[a("div",Rt,[n(l(S),{class:"w-4 h-4 text-primary-400"}),s[17]||(s[17]=a("span",null,"重启阈值",-1))]),a("div",Tt,[n(d,{name:"fade",mode:"out-in"},{default:r(()=>[l(_).retryStatus?(m(),e("span",Nt,c(l(_).retryStatus.restart_threshold)+" 次",1)):v("",!0)]),_:1})])]),l(_).retryStatus&&l(_).retryStatus.cq_times>=l(_).retryStatus.restart_threshold?(m(),e("div",Wt,[a("div",At,[n(l(S),{class:"w-4 h-4 text-warning-400 flex-shrink-0 mt-0.5"}),s[18]||(s[18]=a("div",{class:"text-sm"},[a("p",{class:"text-warning-300 font-medium mb-1"},"即将自动重启"),a("p",{class:"text-slate-400 text-xs"},"重试失败次数过多，为防止无线网卡卡死，系统将自动重启设备。")],-1))])])):v("",!0)])]),a("div",Bt,[a("div",Pt,[a("button",{class:"btn btn-ghost text-danger-400 hover:bg-danger-500/10",onClick:s[0]||(s[0]=t=>Kt.value=!0)},[n(l(R),{class:"w-4 h-4"}),s[19]||(s[19]=a("span",null,"重启系统",-1))]),a("button",{class:"btn btn-ghost",onClick:s[1]||(s[1]=t=>Vt(!0))},[n(l(F),{class:"w-4 h-4"}),s[20]||(s[20]=a("span",null,"刷新状态",-1))])])])]),n(C,{visible:Kt.value,title:"重启确认",icon:l(R),onClose:s[2]||(s[2]=t=>Kt.value=!1)},{footer:r(()=>[a("button",{class:"btn btn-danger flex-1",onClick:Yt},[n(l(R),{class:"w-4 h-4"}),s[22]||(s[22]=u(" 确定重启 ",-1))])]),default:r(()=>[a("div",Dt,[n(l(S),{class:"w-5 h-5 text-danger-400 flex-shrink-0 mt-0.5"}),s[21]||(s[21]=a("div",{class:"text-sm text-slate-300"},[a("p",{class:"font-medium text-danger-400 mb-1"},"确定要重启系统吗？"),a("p",{class:"text-slate-400"},"系统重启期间，WiFi连接将会断开。")],-1))])]),_:1},8,["visible","icon"]),n(C,{visible:Ut.value,title:"关闭中继模式",icon:l(R),onClose:s[4]||(s[4]=t=>Ut.value=!1)},{footer:r(()=>[a("div",Ft,[a("button",{class:"btn btn-secondary flex-1",onClick:s[3]||(s[3]=t=>Ut.value=!1)}," 取消 "),a("button",{class:"btn btn-danger flex-1",onClick:os}," 确定 ")])]),_:1},8,["visible","icon"]),n(C,{visible:Qt.value,title:"异常提示",icon:l(S),closable:!1},{footer:r(()=>[a("button",{class:"btn btn-warning w-full",onClick:es},[n(l(P),{class:"w-4 h-4"}),s[25]||(s[25]=u(" 前往 OpenWrt 无线设置 ",-1))])]),default:r(()=>{var t;return[a("div",Ht,[a("div",Ot,[a("div",zt,[n(l(S),{class:"w-5 h-5 text-warning-400 flex-shrink-0 mt-0.5"}),a("div",Et,[a("p",$t,"检测到 "+c(null==(t=l(_).connectionStatus)?void 0:t.sta_count)+" 个中继接口",1),s[23]||(s[23]=a("p",{class:"text-slate-400 leading-relaxed"},"本项目仅支持单个 STA 中继接口模式，多个接口导致切换异常。",-1))])])]),s[24]||(s[24]=a("div",{class:"p-4 rounded-xl bg-slate-800/50 border border-slate-700/50"},[a("ol",{class:"text-sm text-slate-300 space-y-1.5 list-decimal list-inside"},[a("li",null,"前往 OpenWrt 后台的「网络 - 无线」页面"),a("li",null,"删除多余的中继接口，只保留一个"),a("li",null,"返回本页面刷新")])],-1))])]}),_:1},8,["visible","icon"])],64)}}}),[["__scopeId","data-v-75b5a993"]]);
/**
 * @license lucide-vue-next v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{Gt as default};
